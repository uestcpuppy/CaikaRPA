<!DOCTYPE html >
<html>
  <head>
    <title>财咖网银助手-系统配置</title>
    <meta charset="utf-8">
    <style>
      .divCls {
        width: 100%;
        margin-left: 20px;
      }
      .form {
        border: 1px solid #ccc;
        padding: 10px 200px 10px 10px;
        width: 30%;
        font-weight: 400;
        display: flex;
        align-content: space-between;
        justify-content: space-around;
        align-items: flex-end;
        flex-direction: column;
      }
      select {
        width: 170px;
      }

      .form span {
        margin-right: 10px;
      }

      #tb_company {
        width: 500px;
      }

      #tb_account {
        width: 1200px;
      }

      #tb_template {
        width: 2000px;
      }

      #tb_slot {
        width: 500px;
      }

      table {
        margin-top:10px;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 14px;
        border-spacing: 1px;
        background-color: rgba(201,201,201,1); /*边线颜色*/
        border-collapse: separate;
        width: 100%;
      }

      table td {
        height: 25px;
        border: 0px solid #ddd;
        background-color: #fff;
        padding: 3px;
      }

      table th{
        padding: 3px;
        text-align: left;
        background-color: #d9d9d9;
        color: black;
      }

      table a:link
      {
        text-decoration: none;
        color: blue
      }

      table a:active
      {
        text-decoration:blink
      }

      table a:hover
      {
        text-decoration:underline;
        color: red
      }

      table a:visited
      {
        text-decoration: none;
        color: blue
      }
      table tr:hover td
      {
        background:none;
      }
      table tr:hover
      {
        background-color: #ddd;
      }
    </style>
  <script type="text/javascript"src="jquery.min.js"></script>
  <script type="text/javascript" src="jquery.modal.min.js"></script>
  <script type="text/javascript" src="jquery.pagination.js"></script>
  <script type="text/javascript" src="common.js"></script>
<!--  <link rel="stylesheet" href="admin.css" />-->
  <link rel="stylesheet" href="jquery.modal.min.css" />
<!--  <link rel="stylesheet" href="pagination.css" />-->
  </head>
<body>
  <div class="divCls">
    <h1>财咖网银助手系统配置</h1>
    <h2>一、公司主体配置</h2>
    <h4>操作说明:</h4>
    <p>
      通常一个集团公司可能有N个公司主体, 所以可在此创建多个公司主体。
    </p>
    <div id="companyForm" class="form">
      <div><span>ID:</span><input name="id" readonly="readonly"/></div>
      <div><span>公司名称:</span><input name="name"/></div>
      <div><input  id="addCompany" type="button" value="新增"/><input  id="updateCompany" type="button" value="更新"/></div>
    </div>
    <table id="tb_company"></table>
  </div>

  <div class="divCls">
    <h2>二、银行账户配置</h2>
    <h4>操作说明:</h4>
    <p>
      一个公司主体下, 可能有N个银行账户。</br>
      每个账户具有所属公司、账户简称、银行账号、登录账号、登录密码、优盾密码、所属银行、流水模板8个属性。</br>
      其中, <b>登录密码和优盾密码要输入加密后的值</b>。所属公司、流水模板需提前配置好才能选择。
    </p>
    <div id="accountForm" class="form">
      <div><span>ID:</span><input name="id" readonly="readonly"/></div>
      <div><span>所属公司:</span><select id="companyId"></select></div>
      <div><span>账户简称:</span><input name="shortName"/></div>
      <div><span>银行账号:</span><input name="accountNum"/></div>
      <div><span>登录账号:</span><input name="loginAccount"/></div>
      <div><span>登录密码:</span><input name="loginPwd"/></div>
      <div><span>优盾密码:</span><input name="confirmPwd"/></div>
      <div><span>所属银行:</span><select id="bankId"></select></div>
      <div><span>流水模板:</span><select id="templateId"></select></div>
      <div><input  id="addAccount" type="button" value="新增"/><input  id="updateAccount" type="button" value="更新"/></div>
    </div>
    <table id="tb_account"></table>
  </div>

  <div class="divCls">
    <h2>三、银行模板配置</h2>
    <h4>操作说明:</h4>
    <p>
      银行模板配置用于导入银行流水时, 系统能够找到正确的字段。</br>
      字段说明：</br>
      模板名称 - 模板名称</br>
      所属银行 - 模板对应的一个银行</br>
      SHEET_NAME - 如果时第一个Sheet填0, 第2个填1, 以此类推。</br>
      SKIP_FIRSTROWS - 开始要跳过的行数, 比如要跳过10行数据则填10</br>
      SKIP_LASTROWS - 结尾要跳过的行数, 比如最后5行需要跳过, 则填5</br>
      TRANSACTION_TIME - 交易时间字段对应的列号, 比如对应第5列则填5</br>
      INCOME - 收入字段对应的列号</br>
      EXPENSE - 支出字段对应的列号</br>
      BALANCE - 余额字段对应的列号</br>
      CUSTOMER_ACCOUNT_NAME - 对方账户名称对应的列号</br>
      CUSTOMER_ACCOUNT_NUM - 对方账户对应的列号</br>
      CUSTOMER_BANK_NAME - 对方开户银行对应的列号</br>
      TRANSACTION_ID - 交易流水号对应的列号</br>
      SUMMARY - 摘要对应的列号</br>
      TIME_FORMAT - 交易时间的格式, 例如: %Y-%m-%d %H:%M:%S</br>
    </p>
    <div id="templateForm" class="form">
      <div><span>ID:</span><input name="id" readonly="readonly"/></div>
      <div><span>模板名称:</span><input name="templateName"/></div>
      <div><span>所属银行:</span><select id="templateBankId"></select></div>
      <div><span>SHEET_NAME:</span><input name="sheetName"/></div>
      <div><span>SKIP_FIRSTROWS:</span><input name="skipFirstRows"/></div>
      <div><span>SKIP_LASTROWS:</span><input name="skipLastRows"/></div>
      <div><span>TRANSACTION_TIME:</span><input name="transactionTime"/></div>
      <div><span>INCOME:</span><input name="income" /></div>
      <div><span>EXPENSE:</span><input name="expense" /></div>
      <div><span>BALANCE:</span><input name="balance" /></div>
      <div><span>CUSTOMER_ACCOUNT_NAME:</span><input name="customerAccountName" /></div>
      <div><span>CUSTOMER_ACCOUNT_NUM:</span><input name="customerAccountNum" /></div>
      <div><span>CUSTOMER_BANK_NAME:</span><input name="customerBankName" /></div>
      <div><span>TRANSACTION_ID:</span><input name="transactionId" /></div>
      <div><span>SUMMARY:</span><input name="summary" /></div>
      <div><span>TIME_FORMAT:</span><input name="timeFormat" /></div>
      <div><input  id="addTemplate" type="button" value="新增"/><input  id="updateTemplate" type="button" value="更新"/></div>
    </div>
    <table id="tb_template"></table>
  </div>

  <div class="divCls">
    <h2>四、UsbHub配置</h2>
    <h4>操作说明:</h4>
    <p>
      一个UsbHub最多可配置30个银行账户。</br>
      例如想要指定第一个USB插槽对应ID为10的银行账户</br>
      则新增一条配置信息, SlotNum填1, AccountID填10
    </p>
    <div id="slotForm" class="form">
      <div><span>SlotNum:</span><input name="slotNum"/></div>
      <div><span>AccountID:</span><input name="accountId"/></div>
      <div><input  id="addSlot" type="button" value="新增"/></div>
    </div>
    <table id="tb_slot"></table>
  </div>

  </body>
    <script>

        $(function() {

            function msg(result)
            {
              if(result)
                alert("操作成功")
              else
                alert("操作失败")
            }

            $.ajaxSettings.async = false;

<!--            收付组织配置-->
            function loadTableCompany()
            {

                str = "<tr><th>ID</th><th>公司名称</th><th>操作</th></tr>"
                $("#tb_company").empty()
                $("#tb_company").append(str)
                $.getJSON("/getCompanyList",function(data){
                    $.each(data, function (n, value) {
                        $("#tb_company").append("<tr>\
                        <td>"+value["id"]+"</td>\
                        <td>"+value["name"]+"</td>\
                        <td><input type='button' name='update' value='编辑'/><input type='button' name='delete' value='删除'/></td>\
                        </tr>");
                    });
                });
            }

            loadTableCompany()

            $("#tb_company input[name='delete']").click(function(){
                var id = $(this).parent().siblings(":first").text()
                if(confirm("确定要删除么?"))
                {
                  $.getJSON("/removeCompany&companyId="+id,function(data){
                      msg(data["result"])
                      window.location.reload()
                  });
                }
            })

            $("#tb_company input[name='update']").click(function(){
                var id = $(this).parent().siblings(":first").text()
                $("#companyForm input[name='id']").val(id)
                $("#companyForm input[name='name']").val($(this).parent().siblings().first().next().text())

            })

            $("#addCompany").click(function(){
                var name = $("#companyForm input[name='name']").val()
                $.getJSON("/createCompany&name="+name,function(data){
                      msg(data["result"])
                      window.location.reload()
                });
            })

            $("#updateCompany").click(function(){
                var id = $("#companyForm input[name='id']").val()
                var name = $("#companyForm input[name='name']").val()
                $.getJSON("/updateCompany&id="+id+"&name="+name,function(data){
                      msg(data["result"])
                      window.location.reload()
                });
            })

<!--            银行账户配置-->
            function loadTableAccount()
            {
                str = "<tr><th>ID</th><th>所属公司</th><th>账户简称</th><th>账号</th><th>登录名</th><th>登录密码</th><th>U盾密码</th><th>所属银行</th><th>流水模板</th><th>操作</th></tr>"
                $("#tb_account").empty()
                $("#tb_account").append(str)
                $.getJSON("/getAllAccountList",function(data){
                    $.each(data, function (n, value) {
                        $("#tb_account").append("<tr>\
                        <td>"+value["id"]+"</td>\
                        <td companyId="+value["company_id"]+">"+value["company_name"]+"</td>\
                        <td>"+value["short_name"]+"</td>\
                        <td>"+value["account_num"]+"</td>\
                        <td>"+value["login_account"]+"</td>\
                        <td>"+value["login_pwd_new"]+"</td>\
                        <td>"+value["confirm_pwd_new"]+"</td>\
                        <td bankId="+value["bank_id"]+">"+value["bank_name"]+"</td>\
                        <td templateId="+value["template_id"]+">"+value["template_name"]+"</td>\
                        <td><input type='button' name='update' value='编辑'/><input type='button' name='delete' value='删除'/></td>\
                        </tr>");
                    });
                });
            }

            loadTableAccount()

            $("#tb_account input[name='update']").click(function(){
                currentElement = $(this).parent().siblings(":first")
                $("#accountForm input[name='id']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#companyId").val(currentElement.attr("companyId"))
                currentElement = currentElement.next()
                $("#accountForm input[name='shortName']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#accountForm input[name='accountNum']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#accountForm input[name='loginAccount']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#accountForm input[name='loginPwd']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#accountForm input[name='confirmPwd']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#bankId").val(currentElement.attr("bankId"))
                currentElement = currentElement.next()
                $("#templateId").val(currentElement.attr("templateId"))
            })

            $("#tb_account input[name='delete']").click(function(){
                var id = $(this).parent().siblings(":first").text()
                if(confirm("确定要删除么?"))
                {
                  $.getJSON("/removeAccount&id="+id,function(data){
                      msg(data["result"])
                      window.location.reload()
                  });
                }
            })

            $("#updateAccount").click(function(){
                var id = $("#accountForm input[name='id']").val()
                var loginAccount = $("#accountForm input[name='loginAccount']").val()
                var companyId = $("#companyId option:selected").val()
                var shortName = $("#accountForm input[name='shortName']").val()
                var accountNum = $("#accountForm input[name='accountNum']").val()
                var loginPwd = $("#accountForm input[name='loginPwd']").val()
                var confirmPwd = $("#accountForm input[name='confirmPwd']").val()
                var bankId = $("#bankId option:selected").val()
                var templateId = $("#templateId option:selected").val()
                $.getJSON("/updateAccount&id="+id+"&loginAccount="+loginAccount+"&companyId="+companyId+"&shortName="+shortName+"&accountNum="+accountNum+"&loginPwd="+loginPwd+"&confirmPwd="+confirmPwd+"&bankId="+bankId+"&templateId="+templateId,function(data){
                      msg(data["result"])
                      window.location.reload()
                });
            })

            function initAccountForm()
            {
                $.getJSON("/getCompanyList",function(data){
                    str = ""
                    $.each(data, function (n, value) {
                        str = str + "<option value="+value["id"]+">"+value["name"]+"</option>"
                    });
                    $("#companyId").append(str);
                });

                $.getJSON("/getBankList",function(data){
                    str = ""
                    $.each(data, function (n, value) {
                        str = str + "<option value="+value["id"]+">"+value["name"]+"</option>"
                    });
                    $("#bankId").append(str);
                });

                $.getJSON("/getTemplateList",function(data){
                    str = ""
                    $.each(data, function (n, value) {
                        str = str + "<option value="+value["id"]+">"+value["name"]+"</option>"
                    });
                    $("#templateId").append(str);
                });
            }
            initAccountForm()

            $("#addAccount").click(function(){
                var companyId = $("#companyId option:selected").val()
                var shortName = $("#accountForm input[name='shortName']").val()
                var accountNum = $("#accountForm input[name='accountNum']").val()
                var loginAccount = $("#accountForm input[name='loginAccount']").val()
                var loginPwd = $("#accountForm input[name='loginPwd']").val()
                var confirmPwd = $("#accountForm input[name='confirmPwd']").val()
                var bankId = $("#bankId option:selected").val()
                var templateId = $("#templateId option:selected").val()
                $.getJSON("/createAccount&companyId="+companyId+"&shortName="+shortName+"&accountNum="+accountNum+"&loginAccount="+loginAccount+"&loginPwd="+loginPwd+"&confirmPwd="+confirmPwd+"&bankId="+bankId+"&templateId="+templateId,function(data){
                      msg(data["result"])
                      window.location.reload()
                });
            })

            function loadTableTemplate()
            {

                str = "<tr><th>ID</th>\
                <th>模板名称</th>\
                <th>所属银行</th>\
                <th>SHEET_NAME</th>\
                <th>SKIP_FIRSTROWS</th>\
                <th>SKIP_LASTROWS</th>\
                <th>TRANSACTION_TIME</th>\
                <th>INCOME</th>\
                <th>EXPENSE</th>\
                <th>BALANCE</th>\
                <th>CUSTOMER_ACCOUNT_NAME</th>\
                <th>CUSTOMER_ACCOUNT_NUM</th>\
                <th>CUSTOMER_BANK_NAME</th>\
                <th>TRANSACTION_ID</th>\
                <th>SUMMARY</th>\
                <th>TIME_FORMAT</th>\
                <th>操作</th></tr>"
                $("#tb_template").empty()
                $("#tb_template").append(str)
                $.getJSON("/getTemplateList",function(data){
                    $.each(data, function (n, value) {
                        $("#tb_template").append("<tr>\
                        <td>"+value["id"]+"</td>\
                        <td>"+value["name"]+"</td>\
                        <td bankId="+value["bank_id"]+">"+value["bank_name"]+"</td>\
                        <td>"+value["sheet_name"]+"</td>\
                        <td>"+value["skip_firstrows"]+"</td>\
                        <td>"+value["skip_lastrows"]+"</td>\
                        <td>"+value["transaction_time"]+"</td>\
                        <td>"+value["income"]+"</td>\
                        <td>"+value["expense"]+"</td>\
                        <td>"+value["balance"]+"</td>\
                        <td>"+value["customer_account_name"]+"</td>\
                        <td>"+value["customer_account_num"]+"</td>\
                        <td>"+value["customer_bank_name"]+"</td>\
                        <td>"+value["transaction_id"]+"</td>\
                        <td>"+value["summary"]+"</td>\
                        <td>"+value["time_format"]+"</td>\
                        <td><input type='button' name='update' value='编辑'/><input type='button' name='delete' value='删除'/></td>\
                        </tr>");
                    });
                });
            }

            loadTableTemplate()

            $("#tb_template input[name='update']").click(function(){
                currentElement = $(this).parent().siblings(":first")
                $("#templateForm input[name='id']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='templateName']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateBankId").val(currentElement.attr("bankId"))
                currentElement = currentElement.next()
                $("#templateForm input[name='sheetName']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='skipFirstRows']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='skipLastRows']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='transactionTime']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='income']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='expense']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='balance']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='customerAccountName']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='customerAccountNum']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='customerBankName']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='transactionId']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='summary']").val(currentElement.text())
                currentElement = currentElement.next()
                $("#templateForm input[name='timeFormat']").val(currentElement.text())
            })

            $("#tb_template input[name='delete']").click(function(){
                var id = $(this).parent().siblings(":first").text()
                if(confirm("确定要删除么?"))
                {
                  $.getJSON("/removeTemplate&id="+id,function(data){
                      msg(data["result"])
                      window.location.reload()
                  });
                }
            })

            function initTemplateForm()
            {
                $.getJSON("/getBankList",function(data){
                    str = ""
                    $.each(data, function (n, value) {
                        str = str + "<option value="+value["id"]+">"+value["name"]+"</option>"
                    });
                    $("#templateBankId").append(str);
                });
            }

            initTemplateForm()


            $("#addTemplate").click(function(){
                var url = "/createTemplate"
                url = url + "&templateName="+$("#templateForm input[name='templateName']").val()
                url = url + "&bankId="+$("#templateBankId option:selected").val()
                url = url + "&sheetName="+$("#templateForm input[name='sheetName']").val()
                url = url + "&skipFirstRows="+$("#templateForm input[name='skipFirstRows']").val()
                url = url + "&skipLastRows="+$("#templateForm input[name='skipLastRows']").val()
                url = url + "&transactionTime="+$("#templateForm input[name='transactionTime']").val()
                url = url + "&income="+$("#templateForm input[name='income']").val()
                url = url + "&expense="+$("#templateForm input[name='expense']").val()
                url = url + "&balance="+$("#templateForm input[name='balance']").val()
                url = url + "&customerAccountName="+$("#templateForm input[name='customerAccountName']").val()
                url = url + "&customerAccountNum="+$("#templateForm input[name='customerAccountNum']").val()
                url = url + "&customerBankName="+$("#templateForm input[name='customerBankName']").val()
                url = url + "&transactionId="+$("#templateForm input[name='transactionId']").val()
                url = url + "&summary="+$("#templateForm input[name='summary']").val()
                url = url + "&timeFormat="+$("#templateForm input[name='timeFormat']").val()
                $.getJSON(url,function(data){
                      msg(data["result"])
                      window.location.reload()
                });
            })

            $("#updateTemplate").click(function(){
                var url = "/updateTemplate"
                url = url + "&id="+$("#templateForm input[name='id']").val()
                url = url + "&templateName="+$("#templateForm input[name='templateName']").val()
                url = url + "&bankId="+$("#templateBankId option:selected").val()
                url = url + "&sheetName="+$("#templateForm input[name='sheetName']").val()
                url = url + "&skipFirstRows="+$("#templateForm input[name='skipFirstRows']").val()
                url = url + "&skipLastRows="+$("#templateForm input[name='skipLastRows']").val()
                url = url + "&transactionTime="+$("#templateForm input[name='transactionTime']").val()
                url = url + "&income="+$("#templateForm input[name='income']").val()
                url = url + "&expense="+$("#templateForm input[name='expense']").val()
                url = url + "&balance="+$("#templateForm input[name='balance']").val()
                url = url + "&customerAccountName="+$("#templateForm input[name='customerAccountName']").val()
                url = url + "&customerAccountNum="+$("#templateForm input[name='customerAccountNum']").val()
                url = url + "&customerBankName="+$("#templateForm input[name='customerBankName']").val()
                url = url + "&transactionId="+$("#templateForm input[name='transactionId']").val()
                url = url + "&summary="+$("#templateForm input[name='summary']").val()
                url = url + "&timeFormat="+$("#templateForm input[name='timeFormat']").val()
                $.getJSON(url,function(data){
                      msg(data["result"])
                      window.location.reload()
                });
            })

            function loadTableSlot()
            {

                str = "<tr><th>SLOT_NUM</th><th>ACCOUNT_ID</th><th>账户简称</th><th>操作</th></tr>"
                $("#tb_slot").empty()
                $("#tb_slot").append(str)
                $.getJSON("/getSlotList",function(data){
                    $.each(data, function (n, value) {
                        $("#tb_slot").append("<tr>\
                        <td>"+value["slot_num"]+"</td>\
                        <td>"+value["account_id"]+"</td>\
                        <td>"+value["short_name"]+"</td>\
                        <td><input type='button' value='编辑'/><input type='button' value='删除'/></td>\
                        </tr>");
                    });
                });
            }

            loadTableSlot()

            $("#tb_slot input").click(function(){
                var slotNum = $(this).parent().siblings(":first").text()
                if(confirm("确定要删除么?"))
                {
                  $.getJSON("/removeSlot&slotNum="+slotNum,function(data){
                      msg(data["result"])
                      window.location.reload()
                  });
                }
            })

            $("#addSlot").click(function(){
                var slotNum = $("#slotForm input[name='slotNum']").val()
                var accountId = $("#slotForm input[name='accountId']").val()
                $.getJSON("/createSlot&slotNum="+slotNum+"&accountId="+accountId,function(data){
                      msg(data["result"])
                      window.location.reload()
                });
            })



        });
    </script>
</html>
